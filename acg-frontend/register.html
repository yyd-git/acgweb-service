<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>动漫风格注册</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: 'Press Start 2P', cursive;
        background: linear-gradient(135deg, #f8b195, #f67280, #c06c84, #6c5b7b);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .container {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        width: 350px;
        text-align: center;
        color: #fff;
        box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    h1 { margin-bottom: 30px; color: #ffeaa7; }
    input { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 10px; outline: none; font-size: 14px; }
    button { width: 100%; padding: 12px; margin: 15px 0; border: none; border-radius: 12px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.3s; background: linear-gradient(45deg, #f8b195, #f67280); color: #fff; }
    button:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(255,255,255,0.6); }
    .toggle-btn { background: transparent; border: 2px solid #fff; margin-top: 10px; }
    .message { margin-top: 10px; font-size: 12px; height: 18px; word-break: break-word; }
    .anime-image { width: 100px; margin-bottom: 20px; animation: float 2s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }
</style>
</head>
<body>
<div class="container">
    <img src="https://i.pinimg.com/originals/50/2f/5d/502f5d95c5f7a1b6e2e1eeb0f9e1d1c5.png" alt="anime" class="anime-image">
    <h1>注册</h1>
    <input type="text" id="username" placeholder="用户名">
    <input type="password" id="password" placeholder="密码">
    <button id="register-btn">注册</button>
    <button class="toggle-btn" onclick="location.href='login.html'">去登录</button>
    <div class="message" id="message"></div>
</div>

<script>
// const API_BASE = 'http://localhost:8081/user';
const API_BASE = 'http://localhost:8090/user';

document.getElementById('register-btn').addEventListener('click', async () => {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const messageDiv = document.getElementById('message');

    if (!username || !password) { 
        messageDiv.style.color = 'red';
        messageDiv.textContent = '请输入用户名和密码'; 
        return; 
    }

    const params = new URLSearchParams({ username, password });

    try {
        const response = await fetch(`${API_BASE}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: params,
            credentials: 'include'
        });

        console.log('Response status:', response.status);
        const text = await response.text();
        console.log('Response text:', text);

        let result;
        try {
            result = JSON.parse(text);
        } catch {
            messageDiv.style.color = 'red';
            messageDiv.textContent = '返回非 JSON 数据: ' + text;
            return;
        }

        if(result.code === 1){
            messageDiv.style.color = 'lightgreen';
            messageDiv.textContent = result.msg;
            setTimeout(() => window.location.href='login.html', 1000);
        } else {
            messageDiv.style.color = 'red';
            messageDiv.textContent = result.msg;
        }

    } catch (err) {
        console.error(err);
        messageDiv.style.color = 'red';
        messageDiv.textContent = '网络错误，请重试';
    }
});
</script>
</body>
</html>
